# 農業AIエージェント システム要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
農業AIエージェント「Agri-Partner」

### 1.2 プロジェクトビジョン
LINEで完結する、農家のためのAIパートナー。日常的に使われるLINEプラットフォームをインターフェースとし、農業従事者一人ひとりの農場に特化した、パーソナライズされ、共に進化するデジタルパートナーを提供する。

### 1.3 核心価値提案
- **思考と記憶の代行**: 農業従事者の思考プロセスと記憶を代行し、「次に何をすべきか」を迷うことなく、自信を持って作業に集中できる
- **個別農場最適化**: 各ユーザーの農場情報、栽培履歴、環境条件を学習し、その農場に最適化された判断支援を提供
- **情報統合**: 天気、市況、作業履歴、個別農場データなどの散在情報を統合し、一元的な判断支援を提供
- **経験の蓄積と継承**: 作業経験を蓄積し、新規就農者でも熟練者のような的確な判断ができる支援体制
- **記録・報告の自動化**: 圃場での作業記録を自動化し、事務作業負荷を軽減

## 2. 解決対象の課題

### 2.1 現状課題
| 課題 | 詳細 | 影響 |
|------|------|------|
| 情報の散在 | 天気、市況、作業履歴が別々のツールに分散 | 統合的な判断が困難、意思決定の遅延 |
| 経験と勘への依存 | 新規就農者の判断負荷が大きい | 作業効率低下、ストレス増大 |
| 記録・報告の負荷 | 手作業による日報作成等の非効率性 | 時間コスト増大、記録漏れ |
| 労働力不足と多忙 | 計画立案・記録作業に多大な時間 | 本来業務への集中阻害 |

### 2.2 目標成果（KPI）
| 指標 | 現状 | 目標 | 測定方法 |
|------|------|------|--------|
| 農作業判断時間 | 平均10分 | 0分 | ユーザー行動ログ分析 |
| 新人の迷い時間 | 週平均60分 | 5分未満 | ユーザーアンケート・ログ分析 |
| 作業記録完了率 | - | 95%以上 | システムログ分析 |
| AI応答時間 | - | 平均3秒以内 | システムパフォーマンス監視 |

## 3. システム機能要件

### 3.1 主要機能

#### 3.1.1 対話型AI機能
- **自然言語理解**: 農業専門用語を含む曖昧な質問への対応
- **コンテキスト理解**: 過去の対話履歴を考慮した文脈的応答
- **マルチターン対話**: 複数回のやり取りによる詳細な情報収集・提供

#### 3.1.2 ハイブリッド検索機能
- **キーワード検索**: 品種名、農薬名等の固有名詞の正確な検索
- **ベクトル検索**: 症状や状況の曖昧な表現からの意味的検索
- **統合検索**: Reciprocal Rank Fusionによる両者の融合

#### 3.1.3 マルチエージェントシステム
| エージェント | 役割 | 主要機能 |
|------------|------|--------|
| SupervisorAgent | 思考・記憶の指揮者 | ユーザー意図分析、個別農場コンテキスト管理、適切なエージェント選択 |
| ReadAgent | 個別化情報分析 | ユーザー農場特化検索、パーソナライズされた情報提供、学習履歴活用 |
| WriteAgent | 経験蓄積・記録 | 作業記録、経験学習、個別農場データ蓄積、タスク管理 |

#### 3.1.4 ワークフロー管理機能
- **自動化プロセス**: 防除サイクル等の農作業プロセスの自動実行
- **人間参加型フロー**: 重要な判断ポイントでの確認待ち・承認機能
- **状態管理**: 長期間にわたるワークフローの状態永続化

#### 3.1.5 圃場・作業管理機能
- **圃場情報管理**: 各圃場の基本情報、作付け状況、履歴管理
- **作業スケジュール**: 予定・実績の管理、天候連動スケジューリング
- **記録自動化**: 音声・テキストによる作業記録の自動入力

### 3.2 ユーザーインターフェース要件

#### 3.2.1 LINEチャットインターフェース
- **リアルタイム対話**: 即座の質問・応答
- **リッチメッセージ**: カルーセル、クイックリプライ等による直感的操作
- **ストリーミング応答**: リアルタイムでの応答表示

#### 3.2.2 LIFFダッシュボード
- **ワークフロー状況表示**: アクティブなワークフローの可視化
- **作業カレンダー**: 予定・実績のカレンダー表示
- **圃場マップ**: 圃場配置と状況の地図表示
- **ナレッジベース検索**: 専門情報の直接検索機能

### 3.3 データ管理要件

#### 3.3.1 データベース構造
| コレクション | 用途 | 主要フィールド |
|------------|------|------------|
| users | ユーザー管理 | lineUserId, name, farmId, preferences |
| farms | 個別農場情報 | farmName, address, ownerInfo, climateZone, soilConditions |
| fields | 圃場詳細管理 | fieldName, size, currentCrop, soilType, history, personalNotes |
| tasks | 個別作業管理 | taskName, status, scheduledDate, workflowRunId, farmSpecific |
| knowledgeBase | 汎用ナレッジ | textChunk, embedding, sourceUrl, applicableRegions |
| personalKnowledge | 個別農場知識 | farmId, experience, learnings, customMethods |
| workflows | ワークフロー | runId, status, currentStep, context, farmCustomization |

#### 3.3.2 ナレッジベース要件
- **汎用データソース**: 農研機構、各地域の農業試験場、JA全農等の信頼できる情報源
- **個別化データ**: 各農場の作業履歴、成功事例、失敗経験、カスタム手法
- **更新頻度**: 汎用情報は月次更新、個別情報はリアルタイム学習
- **検索精度**: 90%以上の適合率（個別農場データを優先）

## 4. 非機能要件

### 4.1 性能要件
| 項目 | 要件 | 測定条件 |
|------|------|--------|
| 応答時間 | 平均3秒以内 | 通常クエリ（100文字以内） |
| 同時接続 | 100ユーザー | ピーク時対応 |
| 可用性 | 99.5%以上 | 月間稼働率 |
| データ更新 | リアルタイム | 作業記録の即時反映 |

### 4.2 セキュリティ要件
- **認証**: LINE OAuth 2.0による認証
- **認可**: ユーザーレベルのデータアクセス制御
- **データ暗号化**: 保存時・転送時の暗号化
- **監査ログ**: 全データアクセスの記録

### 4.3 拡張性要件
- **ユーザー拡張**: 1,000ユーザーまでの拡張対応
- **機能拡張**: 新規作物・地域への対応可能なアーキテクチャ
- **API拡張**: 外部システム連携のためのAPI提供

## 5. 技術要件

### 5.1 技術スタック
| 層 | 技術 | 選定理由 |
|----|------|--------|
| フロントエンド | LINE/LIFF | 農業従事者の高い普及率 |
| バックエンド | Mastra Framework | TypeScript型安全性、Agent/Workflow統合 |
| データベース | MongoDB Atlas | ハイブリッド検索、統合データプレーン |
| APIゲートウェイ | Node.js/Express | LINE SDK対応、信頼性 |
| AI/ML | OpenAI GPT-4 | 高品質な自然言語処理 |

### 5.2 アーキテクチャ要件
- **マイクロサービス**: 機能別サービス分離
- **ステートフル/ステートレス分離**: 処理特性に応じた最適化
- **イベント駆動**: 非同期処理による応答性向上

### 5.3 開発・運用要件
- **CI/CD**: GitHub Actions使用
- **コンテナ化**: Docker利用
- **監視**: ログ集約、パフォーマンス監視
- **バックアップ**: 日次自動バックアップ、PITR対応

## 6. 制約事項

### 6.1 技術的制約
- LINE Messaging APIの制限（月1,000メッセージ/無料）
- OpenAI API利用コスト
- MongoDB Atlas容量制限

### 6.2 運用制約
- 24時間365日運用は初期段階では対象外
- 多言語対応は日本語のみ
- 音声認識は将来フェーズで検討

### 6.3 法的・規制制約
- 個人情報保護法準拠
- 農薬取締法等の関連法規への配慮
- データ輸出規制への対応

## 7. 開発スケジュール

### フェーズ1: 基盤システム構築（1-2ヶ月）
- Mastraエージェントシステム開発
- MongoDB Atlas設計・構築
- 基本的なRAG機能実装

### フェーズ2: UI統合開発（3-4週間）
- LINE Webhook統合
- LIFFダッシュボード開発
- エンドツーエンド統合テスト

### フェーズ3: 本番デプロイ（2-3週間）
- 本番環境構築
- パフォーマンスチューニング
- 運用監視設定

### フェーズ4: 運用・改善（継続）
- ユーザーフィードバック収集
- 機能改善・拡張
- ナレッジベース拡充

## 8. リスクと対策

### 8.1 技術リスク
| リスク | 影響度 | 対策 |
|-------|-------|------|
| API制限による機能制約 | 中 | 使用量監視、代替API検討 |
| AI応答品質の不安定性 | 高 | プロンプトチューニング、フォールバック機能 |
| 検索精度の不足 | 高 | ナレッジベース品質向上、ハイブリッド検索最適化 |

### 8.2 運用リスク
| リスク | 影響度 | 対策 |
|-------|-------|------|
| ユーザー導入の遅れ | 中 | 段階的導入、ユーザビリティ向上 |
| データ品質の劣化 | 高 | 定期的な品質チェック、更新プロセス確立 |
| システム障害 | 高 | 冗長化、自動復旧機能、監視強化 |

## 9. 成功判定基準

### 9.1 定量的基準
- 目標KPI達成率90%以上
- ユーザー満足度8/10以上
- システム稼働率99.5%以上

### 9.2 定性的基準
- 農業従事者の日常業務への自然な統合
- 判断支援による作業効率向上の実感
- 新規就農者の学習促進効果の確認

---

**文書管理情報**
- 作成日: 2025年7月31日
- バージョン: 1.0
- 承認者: [承認者名]
- 次回更新予定: フェーズ1完了時